# System Programming


## Kernel Mode Vs User Mode

Linux (and other OSes) has two CPU execution modes:

- User Mode: The mode in which regular applications run (like firefox, vim, php). Programs have limited privileges and cannot directly access hardware or critical system memory.

- Kernel Mode: The mode in which the OS kernel executes. The code here has full access to hardware, memory, and CPU instructions. Only trusted OS code runs in kernel mode.


Example: ls command.

- Normal program runs in user mode.
- Program needs something privileged (like reading a file, sending network packets).
- It issues a system call (open(), read(), write()).
- CPU switches to kernel mode to handle the request.
- Kernel checks permissions, accesses hardware, executes the task.
- Kernel returns control back to user mode.
- The user program gets the result.

Why the Separation Exists
- Security: Applications cannot directly access critical resources.
- Stability: A crash in user mode does not crash the whole system.
- Controlled hardware access: Only kernel can manage CPU, memory, and I/O.


### kernel mode is different than sudo

Yes — kernel mode and sudo are completely different concepts, even though both relate to “privileges.”.
- Kernel mode: CPU execution mode. Happens at the hardware/CPU level.
- sudo: A software mechanism that temporarily runs a command as the root user. It’s about OS permissions, not CPU execution mode.


### Operations that require kernel mode

- System Calls (Most Common): 
    ```c
        open(), read(), write(), fork(), execve(), kill(), mmap(), socket()
    ```

- Hardware Interrupts
    Signals sent to the CPU (from hardware or software) that require immediate kernel handling.

    Examples:
    - Hardware: Keyboard press, network packet arrival, timer interrupt.
    - Software: int 0x80 on x86 (older Linux system call mechanism).

    When an interrupt occurs:

    - CPU temporarily pauses the current task to handle the interrupt in kernel mode.
    - Executes the interrupt handler.
    - Returns to user mode.


- Software Interrupt Exceptions / Traps

    Events generated by the CPU when something unusual happens.

    Examples:

    - Divide by zero
    - Invalid memory access (segmentation fault)
    - Page fault (accessing memory not in RAM yet)

    Kernel mode involvement:

    CPU switches to kernel mode to handle the exception.

    Kernel may terminate the process, send a signal, or load memory page.

Q: if linux is processing with task.. and i kept writting on keyboard.. would that affect the task? since cpu will keep going into kernel mode?

Yes — it can affect the task, but probably very slightly in modern systems almost Negligible — since interrupts are very fast (~microseconds)


Q: if there are high rate of interrupt, this technically can slow down cpu?

yes, interrupts switch cpu into kernel mode and keep switching can cause cpu slow down..
- interrupts can get from a malfunctional usb driver or malfunctional hardware in general than can slow down all system
- if network card receive too many packets. in theory it will slow down but in practice there are alot of optimizations done that network card can effciently receive millions of packets without issues. so to be affected you have to be doing very stiff dos attack and with packets constructed in a way to avoid all the optimizations done in the OS